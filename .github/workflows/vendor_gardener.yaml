name: Vendor Gardener
on:
  push:
    branches:
      - dependabot/go_modules/github.com/gardener/**
  pull_request:
    branches:
      - dependabot/go_modules/github.com/gardener/**

permissions: write-all

jobs:
  run:
    name: Run make revendor
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-go@v3
        with:
          go-version: '^1.19.2'
          
      - name: Use gardener's replaced client-go version
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: .github/client_go_replace.sh
      
      - name: Make revendor
        run: make revendor

      - name: Commit changes
        run: |
          git config user.name github-actions
          git config user.email github-actions@github.com
          git add .
          git commit -m "make revendor"
          git push origin
